{
  "variables": {

    "aws_access_key": "{{ env `AWS_ACCESS_KEY` }}",
    
    "aws_secret_key": "{{ env `AWS_SECRET_KEY` }}",
    
    "aws_region": "{{ env `AWS_REGION` }}",
    
    "source_ami": "{{ env `SOURCE_AMI` }}",
    
    "subnet_id": "{{ env `SUBNET_ID` }}",
    
    "ssh_username": "{{ env `SSH_USERNAME` }}",
    
    "ami_users": "{{ env `AMI_USERS` }}"
    
    },
    "builders": [{

      "type": "amazon-ebs",
      
      "ami_users" : "{{user `ami_users`}}",
      
      "access_key": "{{user `aws_access_key`}}",
      
      "secret_key": "{{user `aws_secret_key`}}",
      
      "region": "{{user `aws_region`}}",
      
      "source_ami": "{{user `source_ami`}}",
      
      "instance_type": "t2.micro",
      
      "ssh_username": "{{user `ssh_username`}}",
      
      "ami_name": "csye6225_a4_{{timestamp}}",
      
      "ami_description": "csye6225 assignment 4",
      
      "launch_block_device_mappings": [
      
      {
      
      "device_name": "/dev/sda1",
      
      "volume_size": 8,
      
      "volume_type": "gp2",
      
      "delete_on_termination": true
      
      }
      
      ]
      }],
    "provisioners": [
      {
        "type": "shell",
        "inline": [
            "sudo apt update -y",
            "sudo apt update -y",
            "sudo apt install nodejs -y",
            "sudo apt-get install nodejs -y",
            "cd /home/ubuntu",
            "sudo apt-get install mysql-server -y",
            "sudo apt update",
            "sudo apt install ruby-full -y",
            "sudo apt install wget -y",
            "wget https://aws-codedeploy-us-east-1.s3.us-east-1.amazonaws.com/latest/install",
            "chmod +x ./install",
            "sudo ./install auto",
            "sudo service codedeploy-agent start",
            "npm i pm2 -g"
        ]
      }
    ]
  }